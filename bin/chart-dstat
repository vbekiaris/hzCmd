#!/usr/bin/env bash

filePattern=${1:-*dstat.csv}
title=${2:-dstat}

	##  THE command      dstat -tciymn --socket --tcp -rsgd

	#----system----
	#    1
	#system-date-time

	#----total-cpu-usage----
	#    2                    3                     4                5                     6                  7
	#total-cpu-usage-usr total-cpu-usage-sys total-cpu-usage-idl total-cpu-usage-wai total-cpu-usage-hiq total-cpu-usage-siq

	#----interrupts---
	#     8              9             10
	#interrupts-33 interrupts-35 interrupts-36

	#---system--
	#     11                        12
	# system-interrupts   system-context-switches

	#------memory-usage-----
	#13     14    15     16
	#used  buff  cach  free

	#-net/total-
	#  17     18
	# recv  send

	# ------sockets------
	# 19  29  21  22  23
	# tot tcp udp raw frg

	#----tcp-sockets----
	# 24  25  26  27 28
	#lis act syn tim clo

	#--io/total-
	# 29    30
	# read  writ

	#----swap---
	# 31    32
 	#used  free

	#---paging--
	# 33   34
	# in   out

	#-dsk/total-
	# 35    36
	#read  writ

plot-csv ${filePattern} 2 ${title} total-cpu-usage-usr
plot-csv ${filePattern} 3 ${title} total-cpu-usage-sys
plot-csv ${filePattern} 4 ${title} total-cpu-usage-idl
plot-csv ${filePattern} 5 ${title} total-cpu-usage-wait
plot-csv ${filePattern} 6 ${title} total-cpu-usage-hardw-interrupt
plot-csv ${filePattern} 7 ${title} total-cpu-usage-softw-interrupt

plot-csv ${filePattern} 8 ${title} interrupts-33
plot-csv ${filePattern} 9 ${title} interrupts-35
plot-csv ${filePattern} 10 ${title} interrupts-35 interrupts-36

plot-csv ${filePattern} 11 ${title} system-interrupts
plot-csv ${filePattern} 12 ${title} system-context-switches

plot-csv ${filePattern} 13 ${title} memory-usage-used
plot-csv ${filePattern} 14 ${title} memory-usage-buff
plot-csv ${filePattern} 15 ${title} memory-usage-cach
plot-csv ${filePattern} 16 ${title} memory-usage-free

plot-csv ${filePattern} 17 ${title} net-total-recv
plot-csv ${filePattern} 18 ${title} net-total-send

plot-csv ${filePattern} 19 ${title} sockets-total
plot-csv ${filePattern} 20 ${title} sockets-tcp
plot-csv ${filePattern} 21 ${title} sockets-udp
plot-csv ${filePattern} 22 ${title} sockets-raw
plot-csv ${filePattern} 23 ${title} sockets-ip-fragments

plot-csv ${filePattern} 24 ${title} tcp-sockets-listen
plot-csv ${filePattern} 25 ${title} tcp-sockets-active
plot-csv ${filePattern} 26 ${title} tcp-sockets-syn
plot-csv ${filePattern} 27 ${title} tcp-sockets-time-wait
plot-csv ${filePattern} 28 ${title} tcp-sockets-close

plot-csv ${filePattern} 29 ${title} io-total-read
plot-csv ${filePattern} 30 ${title} io-total-writ

plot-csv ${filePattern} 31 ${title} swap-used
plot-csv ${filePattern} 32 ${title} swap-free

plot-csv ${filePattern} 33 ${title} paging-in
plot-csv ${filePattern} 34 ${title} paging-out

plot-csv ${filePattern} 35 ${title} disk-total-read
plot-csv ${filePattern} 36 ${title} disk-total-writ

mkdir -p dstat-chart
mv *.png dstat-chart || true
